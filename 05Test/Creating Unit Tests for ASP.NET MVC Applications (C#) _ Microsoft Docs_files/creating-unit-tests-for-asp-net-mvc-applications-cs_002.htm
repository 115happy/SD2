<!DOCTYPE html>
<html wtx-context="B89217DB-003B-48A7-BC3F-3F009FC2692F"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script src="creating-unit-tests-for-asp-net-mvc-applications-cs_data_002/jquery.js"></script><style type="text/css">img[src="https://c1.microsoft.com/c.gif?DI=4050&did=1&t="]
{display:none !important;}</style>
<script src="creating-unit-tests-for-asp-net-mvc-applications-cs_data_002/cookie.js"></script>
<script>(function(){var eventer = window.addEventListener ? window.addEventListener : window.attachEvent;var name = window.addEventListener ? "load" : "onload";eventer(name, function(e){if (window.jQuery){(function(){function e(t,i){function r(e){if(r[e]!==S)return r[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=r("json-stringify")&&r("json-parse");else{var n,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=i.stringify,d="function"==typeof c&&v;if(d){(n=function(){return 1}).toJSON=n;try{d="0"===c(0)&&"0"===c(new a)&&'""'==c(new s)&&c(C)===S&&c(S)===S&&c()===S&&"1"===c(n)&&"[1]"==c([n])&&"[null]"==c([S])&&"null"==c(null)&&"[null,null,null]"==c([S,C,null])&&c({a:[n,!0,!1,null,"\x00\b\n\f\r	"]})==o&&"1"===c(null,n)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new l(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new l(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new l(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new l(-1))}catch(u){d=!1}}t=d}if("json-parse"==e){var f=i.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){n=f(o);var g=5==n.a.length&&1===n.a[0];if(g){try{g=!f('"	"')}catch(u){}if(g)try{g=1!==f("01")}catch(u){}if(g)try{g=1!==f("1.")}catch(u){}}}}catch(u){g=!1}t=g}}return r[e]=!!t}t||(t=o.Object()),i||(i=o.Object());var a=t.Number||o.Number,s=t.String||o.String,c=t.Object||o.Object,l=t.Date||o.Date,d=t.SyntaxError||o.SyntaxError,u=t.TypeError||o.TypeError,f=t.Math||o.Math,g=t.JSON||o.JSON;"object"==typeof g&&g&&(i.stringify=g.stringify,i.parse=g.parse);var p,h,S,m=c.prototype,C=m.toString,v=new l(-0xc782b5b800cec);try{v=-109252==v.getUTCFullYear()&&0===v.getUTCMonth()&&1===v.getUTCDate()&&10==v.getUTCHours()&&37==v.getUTCMinutes()&&6==v.getUTCSeconds()&&708==v.getUTCMilliseconds()}catch(b){}if(!r("json")){var M="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",_="[object Array]",X="[object Boolean]",O=r("bug-string-char-index");if(!v)var E=f.floor,T=[0,31,59,90,120,151,181,212,243,273,304,334],A=function(e,t){return T[t]+365*(e-1970)+E((e-1969+(t=+(t>1)))/4)-E((e-1901+t)/100)+E((e-1601+t)/400)};if((p=m.hasOwnProperty)||(p=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=C?p=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,p=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,p.call(this,e)}),h=function(e,t){var i,o,r,a=0;(i=function(){this.valueOf=0}).prototype.valueOf=0,o=new i;for(r in o)p.call(o,r)&&a++;return i=o=null,a?h=2==a?function(e,t){var n,i={},o=C.call(e)==M;for(n in e)o&&"prototype"==n||p.call(i,n)||!(i[n]=1)||!p.call(e,n)||t(n)}:function(e,t){var n,i,o=C.call(e)==M;for(n in e)o&&"prototype"==n||!p.call(e,n)||(i="constructor"===n)||t(n);(i||p.call(e,n="constructor"))&&t(n)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],h=function(e,t){var i,r,a=C.call(e)==M,s=!a&&"function"!=typeof e.constructor&&n[typeof e.hasOwnProperty]&&e.hasOwnProperty||p;for(i in e)a&&"prototype"==i||!s.call(e,i)||t(i);for(r=o.length;i=o[--r];s.call(e,i)&&t(i));}),h(e,t)},!r("json-stringify")){var W={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},I="000000",$=function(e,t){return(I+(t||0)).slice(-e)},N="\\u00",j=function(e){for(var t='"',n=0,i=e.length,o=!O||i>10,r=o&&(O?e.split(""):e);i>n;n++){var a=e.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=W[a];break;default:if(32>a){t+=N+$(2,a.toString(16));break}t+=o?r[n]:e.charAt(n)}}return t+'"'},U=function(e,t,n,i,o,r,a){var s,c,l,d,f,g,m,v,b,M,O,T,W,I,N,k;try{s=t[e]}catch(D){}if("object"==typeof s&&s)if(c=C.call(s),c!=w||p.call(s,"toJSON"))"function"==typeof s.toJSON&&(c!=x&&c!=y&&c!=_||p.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&1/0>s){if(A){for(f=E(s/864e5),l=E(f/365.2425)+1970-1;A(l+1,0)<=f;l++);for(d=E((f-A(l,0))/30.42);A(l,d+1)<=f;d++);f=1+f-A(l,d),g=(s%864e5+864e5)%864e5,m=E(g/36e5)%24,v=E(g/6e4)%60,b=E(g/1e3)%60,M=g%1e3}else l=s.getUTCFullYear(),d=s.getUTCMonth(),f=s.getUTCDate(),m=s.getUTCHours(),v=s.getUTCMinutes(),b=s.getUTCSeconds(),M=s.getUTCMilliseconds();s=(0>=l||l>=1e4?(0>l?"-":"+")+$(6,0>l?-l:l):$(4,l))+"-"+$(2,d+1)+"-"+$(2,f)+"T"+$(2,m)+":"+$(2,v)+":"+$(2,b)+"."+$(3,M)+"Z"}else s=null;if(n&&(s=n.call(t,e,s)),null===s)return"null";if(c=C.call(s),c==X)return""+s;if(c==x)return s>-1/0&&1/0>s?""+s:"null";if(c==y)return j(""+s);if("object"==typeof s){for(I=a.length;I--;)if(a[I]===s)throw u();if(a.push(s),O=[],N=r,r+=o,c==_){for(W=0,I=s.length;I>W;W++)T=U(W,s,n,i,o,r,a),O.push(T===S?"null":T);k=O.length?o?"[\n"+r+O.join(",\n"+r)+"\n"+N+"]":"["+O.join(",")+"]":"[]"}else h(i||s,function(e){var t=U(e,s,n,i,o,r,a);t!==S&&O.push(j(e)+":"+(o?" ":"")+t)}),k=O.length?o?"{\n"+r+O.join(",\n"+r)+"\n"+N+"}":"{"+O.join(",")+"}":"{}";return a.pop(),k}};i.stringify=function(e,t,i){var o,r,a,s;if(n[typeof t]&&t)if((s=C.call(t))==M)r=t;else if(s==_){a={};for(var c,l=0,d=t.length;d>l;c=t[l++],s=C.call(c),(s==y||s==x)&&(a[c]=1));}if(i)if((s=C.call(i))==x){if((i-=i%1)>0)for(o="",i>10&&(i=10);o.length<i;o+=" ");}else s==y&&(o=i.length<=10?i:i.slice(0,10));return U("",(c={},c[""]=e,c),r,a,o,"",[])}}if(!r("json-parse")){var k,D,R=s.fromCharCode,L={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},z=function(){throw k=D=null,d()},P=function(){for(var e,t,n,i,o,r=D,a=r.length;a>k;)switch(o=r.charCodeAt(k)){case 9:case 10:case 13:case 32:k++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=O?r.charAt(k):r[k],k++,e;case 34:for(e="@",k++;a>k;)if(o=r.charCodeAt(k),32>o)z();else if(92==o)switch(o=r.charCodeAt(++k)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=L[o],k++;break;case 117:for(t=++k,n=k+4;n>k;k++)o=r.charCodeAt(k),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||z();e+=R("0x"+r.slice(t,k));break;default:z()}else{if(34==o)break;for(o=r.charCodeAt(k),t=k;o>=32&&92!=o&&34!=o;)o=r.charCodeAt(++k);e+=r.slice(t,k)}if(34==r.charCodeAt(k))return k++,e;z();default:if(t=k,45==o&&(i=!0,o=r.charCodeAt(++k)),o>=48&&57>=o){for(48==o&&(o=r.charCodeAt(k+1),o>=48&&57>=o)&&z(),i=!1;a>k&&(o=r.charCodeAt(k),o>=48&&57>=o);k++);if(46==r.charCodeAt(k)){for(n=++k;a>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==k&&z(),k=n}if(o=r.charCodeAt(k),101==o||69==o){for(o=r.charCodeAt(++k),(43==o||45==o)&&k++,n=k;a>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==k&&z(),k=n}return+r.slice(t,k)}if(i&&z(),"true"==r.slice(k,k+4))return k+=4,!0;if("false"==r.slice(k,k+5))return k+=5,!1;if("null"==r.slice(k,k+4))return k+=4,null;z()}return"$"},V=function(e){var t,n;if("$"==e&&z(),"string"==typeof e){if("@"==(O?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=P(),"]"!=e;n||(n=!0))n&&(","==e?(e=P(),"]"==e&&z()):z()),","==e&&z(),t.push(V(e));return t}if("{"==e){for(t={};e=P(),"}"!=e;n||(n=!0))n&&(","==e?(e=P(),"}"==e&&z()):z()),(","==e||"string"!=typeof e||"@"!=(O?e.charAt(0):e[0])||":"!=P())&&z(),t[e.slice(1)]=V(P());return t}z()}return e},B=function(e,t,n){var i=F(e,t,n);i===S?delete e[t]:e[t]=i},F=function(e,t,n){var i,o=e[t];if("object"==typeof o&&o)if(C.call(o)==_)for(i=o.length;i--;)B(o,i,n);else h(o,function(e){B(o,e,n)});return n.call(e,t,o)};i.parse=function(e,t){var n,i;return k=0,D=""+e,n=V(P()),"$"!=P()&&z(),k=D=null,t&&C.call(t)==M?F((i={},i[""]=n,i),"",t):n}}}return i.runInContext=e,i}var t="function"==typeof define&&define.amd,n={"function":!0,object:!0},i=n[typeof exports]&&exports&&!exports.nodeType&&exports,o=n[typeof window]&&window||this,r=i&&n[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!r||r.global!==r&&r.window!==r&&r.self!==r||(o=r),i&&!t)e(o,i);else{var a=o.JSON,s=o.JSON3,c=!1,l=e(o,o.JSON3={noConflict:function(){return c||(c=!0,o.JSON=a,o.JSON3=s,a=s=null),l}});o.JSON={parse:l.parse,stringify:l.stringify}}t&&define(function(){return l})}).call(this),function(e){function t(e){return s.raw?e:encodeURIComponent(e)}function n(e){return s.raw?e:decodeURIComponent(e)}function i(e){return t(s.json?JSON.stringify(e):String(e))}function o(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(a," ")),s.json?JSON.parse(e):e}catch(t){}}function r(t,n){var i=s.raw?t:o(t);return e.isFunction(n)?n(i):i}var a=/\+/g,s=e.cookie=function(o,a,c){if(arguments.length>1&&!e.isFunction(a)){if(c=e.extend({},s.defaults,c),"number"==typeof c.expires){var l=c.expires,d=c.expires=new Date;d.setTime(+d+864e5*l)}return document.cookie=[t(o),"=",i(a),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}for(var u=o?void 0:{},f=document.cookie?document.cookie.split("; "):[],g=0,p=f.length;p>g;g++){var h=f[g].split("="),S=n(h.shift()),m=h.join("=");if(o&&o===S){u=r(m,a);break}o||void 0===(m=r(m))||(u[S]=m)}return u};s.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))},e.readCookie=r}(jQuery),function(e,t){function n(e){var t=/function\s+(.+?)\s*\(/,n=t.exec(e.toString());return n&&n.length>1?n[1]:""}var i=e.CoreObject,o=e.CoreObject=function(){};o.extend=function(e,t){var i,r;if(i=this,i.constructor!=Function||"function"!=typeof e)throw"`extend` only supports function-based inheritance";e.prototype=new i;for(r in i)if(i.hasOwnProperty(r)){if("_super"===r||"extend"===r||"create"===r)continue;e[r]=i[r]}for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e._super=i,e.prototype.constructor=e,e.__name__=e.prototype.__name__=n(e),e.prototype.__class__=e,e.extend=o.extend,e.create=o.create,e},o.create=function(){var e=this,n=new e;return n.initialize!==t&&n.initialize.apply(n,arguments),n},o.noConflict=function(){return e.CoreObject=i,o}}(window),function(e,t){var n,i;n=e.location.origin,i=e.locationOrigin,e.locationOrigin={noConflict:function(){var t=e.location.origin;return e.location.origin=n,e.locationOrigin=i,t}},e.location.origin||(e.location.origin=e.location.protocol+"//"+e.location.hostname+(e.location.port?":"+e.location.port:""))}(window),function(e){var t=e.SMCX=new function(){var n=this;this.window=e,this.jQuery=this.$=jQuery.noConflict(!0),this.JSON=e.JSON3.noConflict(),this.locationOrigin=e.locationOrigin.noConflict(),this.Object=e.CoreObject.noConflict(),this.DEBUG_QUERY_PARAM="smcx_debug",this.FORCE_SHOW_QUERY_PARAM="smcx_force_show",n.initialize=function(e){n.PERF=e.perf,t.T("initializing"),n.env=new t.Sandbox.Env,n.env.initialize(e)},n.boot=function(e){n.env.boot(e)},n.destroy=function(){n.env&&n.env.destroy()},n.debug=function(){if(n.env&&n.env.DEBUG)return!0;var i=t.Utils.queryParams(e.parent);return-1!==i.indexOf(n.DEBUG_QUERY_PARAM)},n.T=function(e){n.PERF[e]=new Date-n.PERF[0]}};e.SMCX.Sandbox={}}(window,document),function(e){e.SMCX.log=function(t,n){n=n||{},(SMCX.debug()||n.force)&&e.console&&("string"==typeof t&&(t=n.namespace?"[smcx."+n.namespace+"] "+t:"[smcx] "+t),console.log(t))}}(window),function(e){e.SMCX.Utils={queryParams:function(e){return e.document.location.search},onMobile:function(e){var t,n,i;return n=e.document.documentElement.clientWidth,t=e.innerWidth,i=Math.max(t,n||0),760>=i},xdmSupported:function(e){return!!e.postMessage},browserHasLowStylesLimit:function(e){return!("getComputedStyle"in e)},numStyles:function(e){var t,n,i;return t=e.document,n=t.getElementsByTagName("link").length,i=t.getElementsByTagName("style").length,n+i}}}(window),SMCX.UUID={generate:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}},function(e,t){SMCX.Cookie={filter:function(e,n){this.log("Extracting CX cookies");var i,o,r,a,s;if(e===t)return void this.log("WARNING: tried to extract CX cookies from undefined cookie");o={},e=e.replace(/\+/g," "),e=decodeURIComponent(e),i=e.split(";");for(var c=0,l=i.length;l>c;c++){i[c]=SMCX.$.trim(i[c]);try{r=i[c].split("="),a=r[0],s=r[1],a&&s&&n(a,s)&&(o[a]=s)}catch(d){this.log("WARNING: malformed cookie key-value pair")}}return o},log:function(e,t){t=t||{},t.namespace="cookie",SMCX.log(e,t)}}}(window),function(e){SMCX.Messenger=function(){function e(){f.log("==> unbinding onMessageReceived"),f.window.addEventListener?f.window.removeEventListener("message",t):f.window.detachEvent("onmessage",t)}function t(e){var t=i(e);n(t)&&(t.requestID?r(t,e):o(t,e))}function n(e){return e&&e.eventName&&"sm:"===e.eventName.substring(0,3)}function i(e){var t=e.data;if("string"==typeof t)try{t=SMCX.JSON.parse(t)}catch(n){return f.log("Invalid JSON: could not parse data"),null}return t}function o(e,t){var n=e.eventName,i=f.bindings[n];d(e),i?a(i,[e,t]):f.log("No bindings for "+n)}function r(e,t){var n=e.eventName,i=e.requestID,o=f.bindings[i];u(e),o?a(o,[e,t],function(){delete f.bindings[i]}):f.log("No bindings for "+n)}function a(e,t,n){for(var i,o=0,r=e.length;r>o;o++)i=e[o],i.apply(this,t),n&&n()}function s(){return SMCX.UUID.generate()}function c(e){var t=f.role||"messenger";f.log("Binding "+e+" in "+t)}function l(e,t){var n="Sending "+e+"#"+t.eventID;f.log(n)}function d(e){var t="Message received: "+e.eventName;e.eventID&&(t+="#"+e.eventID),f.log(t)}function u(e){var t="Response received for request: "+e.eventName+"#"+e.requestID;f.log(t)}var f;this.initialize=function(e){f=this,f.bindings={},f.window=e.window},this.bind=function(e,t){c(e),f.bindings[e]||(f.bindings[e]=[]),f.bindings[e].push(t)},this.send=function(e,t){var n,i,o;n=t.target,i=t.targetOrigin,o=t.data||{},o.eventName=e,o.eventID=s(),l(e,o),t.success&&(f.bindings[o.eventID]=[t.success]),o=SMCX.JSON.stringify(o),n.postMessage(o,i)},this.request=function(e,t){if(f.log("Request: "+e),!f.providerFrame)throw"Cannot send a request without loading the provider";t.target=f.providerFrame,t.targetOrigin=f.providerOrigin,f.send(e,t)},this.respondTo=function(e,t,n){var i;f.bind(e,function(o,r){i=t(o,r),i.requestID=o.eventID,f.send(e,{target:f.window.parent,targetOrigin:n.targetOrigin,data:i})})},this.destroy=function(){f.log("Destroying SMCX.Messenger"),e()},this.bindOnMessageReceived=function(){f.window.addEventListener?f.window.addEventListener("message",t,!1):f.window.attachEvent("onmessage",t)},this.log=function(e){SMCX.log(e,{namespace:"messenger"})}}}(window),function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};SMCX.escapeHTML=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return e[t]})},SMCX.unescapeBreaks=function(e){return e.replace(/&lt;br&gt;/g,"<br>")},SMCX.nl2br=function(e){var t="<br>";return(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+t+"$2")}}(),function(e,t){SMCX.Sandbox.Env=function(){function n(e,t){t=t||{},t.namespace="sandbox.env",SMCX.log(e,t)}var i=this;this.initialize=function(t){i.NAME=t.env,i.DEBUG=t.debug,this.__TYPE__="sandbox",n("Initializing environment (type=sandbox, debug="+i.DEBUG+")"),i.$parentWindow=SMCX.$(e.parent),i.$parentDocument=SMCX.$(e.parent.document),i.$parentBody=SMCX.$(e.parent.document.body),i.$stage=i.$parentBody.find("#__smcx__"),i.CX_COOKIES=SMCX.Cookie.filter(e.SM_COOKIE,function(e){return"CX"===e.slice(0,2)}),i.app=SMCX.Sandbox.App.create(t.data,t.settings),SMCX.T("initialized"),i.initialized=!0,e.parent.SMCX.env.trigger("smcx.sandbox:init",e,SMCX)},this.boot=function(o){SMCX.T("booting"),n("Booting SMCX"),SMCX.$(t).ready(function(){i.app.boot(function(){SMCX.T("booted"),i.app.render(function(){SMCX.T("rendered"),n(SMCX.PERF,{force:!0}),e.parent.SMCX.env.trigger("smcx.sandbox:boot",e,SMCX),o&&o(SMCX)})})})},this.destroy=function(){n("Destroying SMCX (type=sandbox)"),i.app&&(i.app.destroy(),i.app=null)}}}(window,document),SMCX.Sandbox.App=SMCX.Object.extend(function(){function e(e){var t,n,i,o={};return i=SMCX.$(e),i.map(function(e,i){n=i.id,n&&(n=n.replace("smcx_","").replace("_template",""),t=SMCX.$.trim(i.innerHTML),t=t.replace(/(\r\n|\n|\r)/gm,"").replace(/\s{2,}/g,""),o[n]=t)}),o}function t(){for(var e=a.assets.css,t=0;t<e.length;t++){var n=e[t];r(n)}}function n(){a.messenger.bindOnMessageReceived(),a.messenger.bind("sm:close_window",i)}function i(){a.widgetView.animateOut()}function o(e){a.widgetView.isShowable(function(t){t?a.widgetView.insert().animateIn(function(){e&&e.call(e)}):(a.log("widgetView was not showable"),e&&e.call(e))})}function r(e){var t="<style class='smcx-style' type='text/css'>"+e+"</style>";SMCX.env.$stage.append(SMCX.$(t))}var a=this;this.initialize=function(t,n){a.log("Initializing SMCX.Sandbox.App"),a.booted=!1,a.widget=null,a.widgetView=null,a.assets={css:[]},a.config=SMCX.Sandbox.Configuration.create(n),a.messenger=new SMCX.Messenger,a.messenger.initialize({window:window.parent}),SMCX.TEMPLATES=e(t.sdk_html),a.assets.css.push(t.sdk_css),a.assets.css.push(t.widget_css),a.widget=SMCX.Sandbox.WidgetFactory.create(t.widget_attrs),a.widgetView=SMCX.Sandbox.WidgetViewFactory.create(a.widget)},this.boot=function(e){a.log("Booting SMCX.Sandbox.App"),SMCX.$(document).ready(function(){t(),a.booted=!0,n(),e&&e.call(e)})},this.render=function(e){a.log("Rendering SMCX.Sandbox.App"),o(e)},this.destroy=function(){a.log("Destroying SMCX.Sandbox.App"),a.messenger&&(a.messenger.destroy(),a.messenger=null),a.booted&&(a.widgetView.$el.remove(),SMCX.env.$parentBody.find(".smcx-style").remove())},this.log=function(e){SMCX.log(e,{namespace:"app"})}}),SMCX.Sandbox.Configuration=SMCX.Object.extend(function(){var e=this;this.settings=null,this.initialize=function(e){this.settings=e},this.settingsFor=function(t){for(var n,i,o,r=0,a=e.settings.length,s={};a>r;r++)n=e.settings[r],n[0]==t&&(i=n[1],o=n[2],s[i]=o);return s}}),SMCX.Sandbox.WidgetFactory=new function(){function e(e){var n,i;if(n=t.WIDGET_TYPES[e],!n)throw i=e+" is an invalid type for SMCX.Sandbox.Widget";return SMCX.Sandbox[n]}var t=this;this.WIDGET_TYPES={EmbedWidget:"EmbedWidget",ModalInvitationWidget:"ModalInvitationWidget",ModalSurveyWidget:"ModalSurveyWidget"},this.create=function(t,n){var i,o;return o=e(t.type),i=new o,i.initialize(t,n),i}},function(e,t){SMCX.Sandbox.Widget=SMCX.Object.extend(function(){var e;this.COLLECTOR_STATUSES={open:"open",closed:"closed"},this.initialize=function(t){e=this,e.id=t.id,e.smCollectorId=t.sm_collector_id,e.type=t.type,e.collectorStatus=t.collector_status,e.url=t.url,e.hideBranding=!!t.hide_branding},this.isEmbed=function(){return"EmbedWidget"==this.type},this.isModalInvitation=function(){return"ModalInvitationWidget"==this.type},this.isModalSurvey=function(){return"ModalSurveyWidget"==this.type},this.isSampleable=function(){return e.sampleRate!==t},this.collectorIsOpen=function(){return e.collectorStatus==e.COLLECTOR_STATUSES.open},this.collectorIsClosed=function(){return e.collectorStatus==e.COLLECTOR_STATUSES.closed},this.parametrizedUrl=function(){var t,n,i;return t=e.url,i="",n=SMCX.env.app.config.settingsFor("custom_variable"),SMCX.$.isEmptyObject(n)||(i+=SMCX.$.param(n)),i.length&&(t+="?"+i),t}})}(window),SMCX.Sandbox.EmbedWidget=SMCX.Sandbox.Widget.extend(function(){var e=SMCX.Sandbox.EmbedWidget.prototype;this.initialize=function(t){e.initialize.apply(this,arguments),this.bgColorA=t.bg_color_a,this.hideOnRepeatVisits=t.hide_on_repeat_visits}}),SMCX.Sandbox.ModalInvitationWidget=SMCX.Sandbox.Widget.extend(function(){var e=SMCX.Sandbox.ModalInvitationWidget.prototype;this.initialize=function(t){e.initialize.apply(this,arguments),this.headline=t.headline,this.message=t.message,this.primaryBtnText=t.primary_btn_text,this.secondaryBtnText=t.secondary_btn_text,this.bgColorA=t.bg_color_a,this.sampleRate=t.sample_rate}}),SMCX.Sandbox.ModalSurveyWidget=SMCX.Sandbox.Widget.extend(function(){var e=SMCX.Sandbox.ModalSurveyWidget.prototype;this.initialize=function(t){e.initialize.apply(this,arguments),this.headline=t.headline,this.bgColorA=t.bg_color_a,this.sampleRate=t.sample_rate}}),SMCX.Sandbox.WidgetViewFactory=new function(){function e(e){var n=t.TYPE_TO_VIEW_MAP[e];if(!n)throw"Invalid type: must be one of 'EmbedWidget', 'ModalInvitationWidget', or 'ModalSurveyWidget', but it was "+e;return SMCX.Sandbox[n]}var t=this;this.TYPE_TO_VIEW_MAP={EmbedWidget:"EmbedWidgetView",ModalInvitationWidget:"ModalInvitationWidgetView",ModalSurveyWidget:"ModalSurveyWidgetView"},this.create=function(t,n){var i,o;return o=e(t.type),i=new o,i.initialize(t,n),i}},SMCX.Sandbox.WidgetView=SMCX.Object.extend(function(){function e(e){return e.classes.off.join(" ")}function t(e){return e.classes.on.join(" ")}function n(){var e=SMCX.Utils.queryParams(window.parent);return e.indexOf(SMCX.FORCE_SHOW_QUERY_PARAM)>0||"file:"===document.location.protocol}var i;this.WIDGET_TYPES={embed:"EmbedWidget",modalInvitation:"ModalInvitationWidget",modalSurvey:"ModalSurveyWidget"},this.ANIMATION_DURATION=300,this.SHOW_CLASS="smcx-show",this.HIDE_CLASS="smcx-hide",this.initialize=function(e,t){if(i=this,i.widget=e,i.classes={off:[],on:[]},!i.templateName)throw"Subclasses of WidgetView must set `templateName`";i.$el=i._createElement(i.templateName),i._setClasses(),i._bindEvents(i.$el)},this._createElement=function(e){var t=SMCX.TEMPLATES[e];return SMCX.$(t)},this._setClasses=function(){var e=i.widget.bgColorA.replace("#","");parseInt(e,16)>13421771?i.classes.on.push("smcx-widget-light"):i.classes.on.push("smcx-widget-dark"),i.widget.hideBranding&&i.classes.on.push("smcx-hide-branding")},this._bindEvents=function(){},this.render=function(){return SMCX.log("Rendering an SMCX.Sandbox.WidgetView"),this.$el.addClass(e(this)),this},this.insert=function(){},this.animateIn=function(n){var i=this;i.$el.removeClass(i.HIDE_CLASS).addClass(i.SHOW_CLASS),setTimeout(function(){i.$el.removeClass(e(i)).addClass(t(i)),i.setLastShownAt(),n&&n.call(n)},0)},this.animateOut=function(n){var i=this;i.$el.removeClass(t(i)).addClass(e(i)),setTimeout(function(){i.$el.removeClass(i.SHOW_CLASS).addClass(i.HIDE_CLASS),n&&n.call(n)},i.ANIMATION_DURATION)},this.isShowable=function(e){var t,i,o,r,a;return t=this,i=!1,n()?(i=!0,void e.call(e,i)):t.widget.isEmbed()&&!SMCX.$(window.parent.document).find("body #smcx-sdk").length?(SMCX.log("WidgetView is not showable because script is in <head>"),i=!1,void e.call(e,i)):(a=t.respondentStatusFor(t.widget.smCollectorId),SMCX.log("User has taken survey? "+a.userHasTakenSurvey),t.widget.collectorIsOpen()&&(a.userHasTakenSurvey?t.widget.isEmbed()&&!t.widget.hideOnRepeatVisits&&(i=!0):t.widget.isEmbed()?i=!0:t.widget.isSampleable()?(o=Math.random()>t.widget.sampleRate/100,r=t.getLastShownAt(),o||r||(i=!0)):i=!0),void e.call(e,i))},this.getLastShownAt=function(){var e="smcx_"+i.widget.id+"_last_shown_at";return SMCX.$.cookie(e)},this.setLastShownAt=function(){var e="smcx_"+i.widget.id+"_last_shown_at",t=(new Date).getTime();SMCX.$.cookie(e,t)},this.respondentStatusFor=function(e){var t,n,i;return i="CX_"+e,n=SMCX.env.CX_COOKIES[i],t={userHasTakenSurvey:Boolean(n)}}}),SMCX.Sandbox.EmbedWidgetView=SMCX.Sandbox.WidgetView.extend(function(){var e=SMCX.Sandbox.EmbedWidgetView.prototype;this.templateName="embed",this.render=function(){return e.render.call(this),this.$el.find("iframe").attr("src",this.widget.parametrizedUrl()),this},this.insert=function(){return SMCX.env.$parentBody.find("#smcx-sdk").before(this.render().$el),e.insert.call(this),this},this._setClasses=function(){e._setClasses.call(this)},this._bindEvents=function(){e._bindEvents.call(this)}}),SMCX.Sandbox.ModalInvitationWidgetView=SMCX.Sandbox.WidgetView.extend(function(){var e=this,t=SMCX.Sandbox.ModalInvitationWidgetView.prototype;e.templateName="modal_invitation",e.render=function(){t.render.call(e);var n,i,o,r,a;return n=SMCX.escapeHTML(e.widget.headline),i=SMCX.unescapeBreaks(SMCX.escapeHTML(SMCX.nl2br(e.widget.message))),o=SMCX.escapeHTML(e.widget.primaryBtnText),r=SMCX.escapeHTML(e.widget.secondaryBtnText),a=e.widget.parametrizedUrl(),e.$el.find("[smcx-modal-headline]").html(n),e.$el.find("[smcx-modal-message]").html(i),e.$el.find("[smcx-btn-primary]").html(o),e.$el.find("[smcx-btn-secondary]").html(r),e.$el.find("[smcx-btn-primary]").attr("href",a),e},e.insert=function(){return SMCX.env.$parentBody.append(e.render().$el),t.insert.call(e),e},e._setClasses=function(){t._setClasses.call(e),e.classes.off.push("smcx-modal-offset-bottom"),e.classes.off.push("smcx-transparent"),e.classes.on.push("smcx-opaque")},e._bindEvents=function(){t._bindEvents.call(e),e.$el.find(".smcx-modal-close").on("click",function(t){t.preventDefault(),e.animateOut()}),e.$el.find("[smcx-btn-primary]").on("click",function(t){e.animateOut()}),e.$el.find("[smcx-btn-secondary]").on("click",function(t){t.preventDefault(),e.animateOut()})}}),SMCX.Sandbox.ModalSurveyWidgetView=SMCX.Sandbox.WidgetView.extend(function(){var e=this,t=SMCX.Sandbox.ModalSurveyWidgetView.prototype;e.templateName="modal_survey",e.render=function(){t.render.call(e);var n,i;return n=SMCX.escapeHTML(e.widget.headline),i=e.widget.parametrizedUrl(),e.$el.find("[smcx-modal-headline]").html(n),e.$el.find("iframe").attr("src",i),e},e.insert=function(){return SMCX.env.$parentBody.append(e.render().$el),t.insert.call(e),e},e._setClasses=function(){t._setClasses.call(e),e.classes.off.push("smcx-modal-offset-bottom"),e.classes.off.push("smcx-transparent"),e.classes.on.push("smcx-opaque")},e._bindEvents=function(){t._bindEvents.call(e),e.$el.find(".smcx-modal-close").on("click",function(t){t.preventDefault(),e.animateOut()})}}),function(e){if(parent&&parent.SMCX&&parent.SMCX.env&&parent.window.SMCX.env){var t=parent.SMCX.env;"test"===t.NAME&&(e.onerror=e.parent.SMCX.onerror),t.trigger("smcx.container:sdkjs:loaded",e),t.options.sandbox.init&&(SMCX.initialize({env:t.NAME,debug:t.DEBUG,data:t.options.sandbox.data,settings:t.settings,perf:parent.SMCX.PERF}),t.options.sandbox.boot&&SMCX.env.initialized&&SMCX.boot())}}(window);
}});}());</script></head><body></body></html>