Livefyre.define(function(){function a(){for(var a={},b=document.getElementsByTagName("meta"),c=0;c<b.length;c++)b[c].getAttribute("name")&&(a[b[c].getAttribute("name")]=b[c].getAttribute("content"));return a}function b(a,b){return b&&a[b]}function c(){var a=document.getElementsByTagName("title");return a.length&&a[0].childNodes.length?a[0].childNodes[0].nodeValue:document.title}function d(a,b){var c=new XMLHttpRequest,d="GET",e=/^[23]\d\d$/;c.open(d,a,!0),c.onreadystatechange=function(a){c.readyState===XMLHttpRequest.DONE&&(String(c.status).match(e)?b(c.responseText):j("HTTP Request failure, statusText = "+c.statusText))},c.send(null)}function e(a,b,c){a&&"function"==typeof a&&a({statusCode:b,valueObject:c})}function f(a,b){var c,d=a;for(c in b){var e=new RegExp("{"+c+"}","g");d=d.replace(e,b[c])}return d}function g(a){var b=a.indexOf("?");b>=0&&(a=a.substr(0,b));var c=a.indexOf("#");return c>=0&&(a=a.substr(0,c)),a}var h=window.console&&"function"==typeof window.console.error,i={SUCCESS:0,FAILURE:1},j=function(a){h&&window.console.error(a)};String.prototype.hashCode=function(){var a,b,c,d=0;if(0===this.length)return d;for(a=0,c=this.length;a<c;a++)b=this.charCodeAt(a),d=(d<<5)-d+b,d|=0;return d};var k=function(h){var k=a(),l=c(),m=g(b(k,h.documentUrlMetaName)||window.location.href||""),n=b(k,h.documentIdMetaName)||m.hashCode(),o=b(k,h.localeMetaName),p=n;o&&(p+="-"+o);var q="/collectionToken?network={network}&site_id={siteId}&title={title}&article_id={articleId}&url={url}",r=f(q,{network:h.network,siteId:h.siteId,title:encodeURIComponent(l),articleId:p,url:encodeURIComponent(m)});d(h.tokenServer+r,function(a){var b=JSON.parse(a);if(Livefyre.require(["fyre.conv#3"],function(a){function c(){new a(d,[f],function(a){e(h.commentCallback,i.SUCCESS,a)})}var d={network:h.network},f={siteId:h.siteId,articleId:p,el:h.containerElementId,checksum:b.checksum,collectionMeta:b.token};c()},function(a){j(a),e(h.commentCallback,i.FAILURE,a)}),h.sidenoteSelectors&&Livefyre.require(["sidenotes#1"],function(a){function c(){var b=new a(d);e(h.sidenoteCallback,i.SUCCESS,b)}var d={network:h.network,siteId:h.siteId,selectors:h.sidenoteSelectors,articleId:p,checksum:b.checksum,collectionMeta:b.token};c()},function(a){j(a),e(h.sidenoteCallback,i.FAILURE,a)}),h.customIdentityServiceCallback)Livefyre.require(["auth"],function(a){e(h.customIdentityServiceCallback,i.SUCCESS,a)},function(a){j(a),e(h.customIdentityServiceCallback,i.FAILURE,a)});else{var c="https://identity.t402.livefyre.com/";"microsoft.fyre.co"===h.network&&(c="https://identity.livefyre.com/"),Livefyre.require(["auth","identity#1"],function(a,b){var d=new b({app:c+h.network});a.delegate(d),e(h.identityServiceCallback,i.SUCCESS,a)},function(a){j(a),e(h.identityServiceCallback,i.FAILURE,a)})}})};return{initializeLivefyre:k}});